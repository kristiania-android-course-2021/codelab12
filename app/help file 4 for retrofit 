
Adding retrofit for backend api calling

1. Adding Retrofit dependencies in the app gradle

    implementation 'com.squareup.retrofit2:retrofit:2.9.0'
    implementation 'com.squareup.retrofit2:converter-gson:2.7.1'


2. Now add a package "retrofit" under datasources

    2.1 Add SummaryResponse class under retrofit package

    data class SummaryResponse(var Countries: List<CountryStats>?)


3. Add CovidApi interfaces with summary endpoint definition

Add interface as follows under package retrofit

import com.learning.codelab12.datasources.retrofit.SummaryResponse
import retrofit2.Call
import retrofit2.http.GET

interface CovidApi {

    @GET("summary")
    fun getSummary(): Call<SummaryResponse>

}

4. Adding CovidApiClient class under package retrofit

    4.1 Add class

    class CovidApiClient {

        private var covidApi: CovidApi
        init {
            val gson = GsonBuilder().setDateFormat("yyyy-MM-dd'T'HH:mm:ss").create()

            val retrofit = Retrofit.Builder()
                .addConverterFactory(
                    GsonConverterFactory.create()
                )
                .addConverterFactory(GsonConverterFactory.create(gson))
                .baseUrl("https://api.covid19api.com/")
                .build()

            covidApi = retrofit.create(CovidApi::class.java)
        }
    }

    4.2 Add function getSummary(): List<CountryStats>

    fun getSummary(): List<CountryStats> {

    }

    4.3 Update the getSummary implementation as follows

    fun getSummary(): List<CountryStats> {

            var response = covidApi.getSummary().execute()

            try {
                if(response.isSuccessful) {
                    response.body()?.Countries?.let { countries->
                        return countries
                    }
                }
            }
            catch (ex: Exception){
                ex.printStackTrace()
            }

            return ArrayList()
     }

5 Go to  CovidRepo class and switch the backend api implementation

       5.1  Declare following in CovidRepo class

        private val covidApiClient = CovidApiClient()

        5.2 Update getCountriesSummary() function of  CovidRepo class as follows

        suspend fun getCountriesSummary() : List<CountryStats>  {
                var list  = covidApiClient.getSummary()
                return list.sortedByDescending {it.TotalConfirmed}
        }


Run the code in emulator now!!


    





